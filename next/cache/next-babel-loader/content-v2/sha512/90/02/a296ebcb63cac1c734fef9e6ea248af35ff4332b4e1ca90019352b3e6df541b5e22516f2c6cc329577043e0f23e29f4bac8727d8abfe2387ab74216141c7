{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*!\n=========================================================\n* Proyecto: mssr-pays-integration\n* Componente : CheckoutBuy\n* Autor : José silva (RationalIT)\n* Versión : 1.0.0\n=========================================================\n*/\nimport React, { Component } from \"react\"; // nodejs library that concatenates classes\n\nimport classnames from \"classnames\";\nimport * as $ from 'jquery'; //Componente Boton de pago paypal\n\nimport TransbankCheck from \"../../../src/components/checkoutBuy/Transbank/TransbankCheck\";\nimport * as functions from '../../../src/components/shared/functions';\nimport environment from '../../../src/environments/environments'; // reactstrap components\n\nimport { Card, CardBody, Form, Button, Input, InputGroupAddon, InputGroup, Media, Container, Row, Table, Col } from \"reactstrap\";\nimport { withRouter, NextRouter } from 'next/router';\n/*!=======================================================\n  * Nombre: Shopping\n  * Descripción: Carga la informacion del carrito de compras\n  =========================================================*/\n\nclass Checkout extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"API_URI\", environment.apiUrlAws);\n\n    _defineProperty(this, \"setDatosContacto\", (d, e) => {\n      switch (d) {\n        case \"nombre\":\n          this.setState({\n            nombre: e.target.value\n          });\n          break;\n\n        case \"email\":\n          this.setState({\n            email: e.target.value\n          });\n          break;\n      }\n    });\n\n    _defineProperty(this, \"FinalizarCompra\", (props, e) => {\n      let emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\n\n      if (this.state.nombre == \"\" || this.state.email == \"\") {\n        $(\".alert-danger.cn\").css(\"display\", \"block\");\n        this.setState({\n          mensajeError: \"Debe proporcionar un nombre y un email de contacto.\"\n        });\n        return false;\n      }\n\n      if (emailRegex.test(this.state.email) == false) {\n        $(\".alert-danger.cn\").css(\"display\", \"block\");\n        this.setState({\n          mensajeError: \"Email inválido.\"\n        });\n        return false;\n      }\n\n      let contact = {};\n      contact['nombre'] = this.state.nombre;\n      contact['email'] = this.state.email;\n      localStorage.setItem('contact', JSON.stringify(contact));\n      this.setState({\n        mensajeError: \"\"\n      });\n      let cat = this.state.categoria;\n      let duracion = this.state.duracion;\n      let method = this.state.method;\n      let prop = this.props;\n\n      if (this.state.method == \"transbank\") {\n        //Array data Create orden\n        let arr = {};\n        this.state.products.forEach(data => {\n          arr['email'] = this.state.email;\n          arr['nombre'] = this.state.nombre;\n          arr['descuento'] = this.state.descuento;\n          arr['total'] = this.state.total;\n          arr['cupon'] = this.state.cupon;\n          arr['productos'] = [{\n            \"duracion\": this.state.duracion,\n            \"currency\": data.currency,\n            \"categoria\": functions.capitalizarPrimeraLetra(cat),\n            \"cantidad\": 1\n          }];\n        }); //Crear orden de pago transbank\n\n        return fetch(`${this.API_URI}/checkout/order/tbk`, {\n          method: 'POST',\n          body: JSON.stringify(arr),\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          }\n        }).then(function (res) {\n          //console.log('res:', res);\n          return res.json();\n        }).then(function (data) {\n          if (data.statusCode == \"200\") {\n            console.log('###200###');\n            global.orden = data.body;\n            global.method = method;\n            prop.router.push({\n              pathname: `/payment/order/${cat}/${duracion}/`\n            });\n          }\n        }).catch(err => console.log('#Error#', err));\n      }\n\n      if (this.state.method == \"paypal\") {\n        global.method = method;\n        prop.router.push({\n          pathname: `/payment/order/${cat}/${duracion}/`\n        });\n      }\n    });\n\n    this.state = {\n      products: [],\n      detail: [],\n      dataphone: [],\n      exchanges: \"\",\n      categoria: \"\",\n      duracion: \"\",\n      paymentTabs: 1,\n      discountFocus: undefined,\n      precio: 0,\n      subTotal: 0,\n      descuento: \"0\",\n      total: 0,\n      method: \"\",\n      email: \"\",\n      nombre: \"\",\n      cupon: \"\",\n      mensajeError: \"\"\n    };\n    this.getProductsLS = this.getProductsLS.bind(this, props);\n  }\n\n  static getInitialProps({\n    query: {\n      categoria,\n      duracion\n    }\n  }) {\n    return {\n      categoria: categoria,\n      duracion: duracion\n    };\n  }\n  /*!=======================================================\n  * Nombre:  getProductsLS\n  * Descripción: \n  =========================================================*/\n\n\n  getProductsLS(props) {\n    this.setState({\n      categoria: props.categoria,\n      duracion: props.duracion\n    });\n    const products = localStorage.getItem('table');\n    const detail = JSON.parse(localStorage.getItem('detail'));\n    this.setState({\n      products: JSON.parse(products),\n      detail: detail,\n      subTotal: detail.amt,\n      total: detail.amt,\n      precio: detail.amt,\n      method: detail.method\n    }); //console.log('STATE getProductsLS:', this.state);\n  }\n  /*!=======================================================\n   * Nombre: componentDidMount\n   * Descripción: \n   =========================================================*/\n\n\n  componentDidMount() {\n    this.getProductsLS();\n  }\n  /*!=======================================================\n   * Nombre: setDatosContacto\n   * Descripción: \n   =========================================================*/\n\n\n  render() {\n    let dataTable = [];\n    let cpagoFinalizarCompra = [];\n    let estado = this.state;\n    let detail = {};\n    this.state.products.map((data, i) => {\n      for (let dia in data.price) {\n        if (dia !== this.state.categoria) continue;\n        detail = data.price[dia];\n      }\n\n      const applyDiscount = e => {//console.log('applyDiscount e', e);\n      };\n\n      cpagoFinalizarCompra.push( /*#__PURE__*/_jsx(Card, {\n        children: /*#__PURE__*/_jsxs(CardBody, {\n          children: [/*#__PURE__*/_jsxs(Form, {\n            className: \"code-validate\",\n            children: [/*#__PURE__*/_jsx(\"label\", {\n              children: \"Descuento\"\n            }), /*#__PURE__*/_jsxs(InputGroup, {\n              className: classnames({\n                \"input-group-focus\": this.state.discountFocus\n              }),\n              children: [/*#__PURE__*/_jsx(Input, {\n                className: \"fc-val\",\n                \"aria-label\": \"Discount\",\n                name: \"name\",\n                placeholder: \"codigo descuento\",\n                type: \"text\" // onFocus={(e) => setDiscountFocus(true)}\n                //onBlur={(e) =>  setDiscountFocus(false)}\n\n              }), /*#__PURE__*/_jsx(InputGroupAddon, {\n                addonType: \"append\",\n                children: /*#__PURE__*/_jsx(Button, {\n                  onClick: e => applyDiscount(e),\n                  className: \"btn-grad\",\n                  color: \"primary\",\n                  type: \"button\",\n                  children: \"Aplicar\"\n                })\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"hr\", {\n            className: \"line-info mb-3\"\n          }), /*#__PURE__*/_jsxs(Media, {\n            className: \"align-items-center\",\n            children: [/*#__PURE__*/_jsx(\"h3\", {\n              className: \"h6 text-secondary mr-3\",\n              children: \"Subtotal\"\n            }), /*#__PURE__*/_jsx(Media, {\n              body: true,\n              className: \"text-right\",\n              children: /*#__PURE__*/_jsxs(\"span\", {\n                className: \"color-mssr\",\n                children: [data.currency, \" \", estado.subTotal]\n              })\n            })]\n          }), /*#__PURE__*/_jsxs(Media, {\n            className: \"align-items-center\",\n            children: [/*#__PURE__*/_jsx(\"h3\", {\n              className: \"h6 text-secondary mr-3\",\n              children: \"Descuento\"\n            }), /*#__PURE__*/_jsx(Media, {\n              body: true,\n              className: \"text-right\",\n              children: /*#__PURE__*/_jsxs(\"span\", {\n                className: \"color-mssr\",\n                children: [estado.descuento, \" %\"]\n              })\n            })]\n          }), /*#__PURE__*/_jsx(\"hr\", {\n            className: \"line-info mb-3\"\n          }), /*#__PURE__*/_jsxs(Media, {\n            className: \"align-items-center\",\n            children: [/*#__PURE__*/_jsx(\"h3\", {\n              className: \"h6\",\n              children: \"Total\"\n            }), /*#__PURE__*/_jsx(Media, {\n              body: true,\n              className: \"text-right\",\n              children: /*#__PURE__*/_jsxs(\"span\", {\n                className: \"font-weight-semi-bold color-mssr\",\n                children: [data.currency, \" \", estado.total]\n              })\n            })]\n          }), /*#__PURE__*/_jsx(\"hr\", {\n            className: \"line-info mb-3\"\n          }), /*#__PURE__*/_jsx(\"h4\", {\n            className: \"mb-1\",\n            children: \"Datos de contacto:\"\n          }), /*#__PURE__*/_jsxs(Form, {\n            className: \"form \",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"form-group\",\n              children: /*#__PURE__*/_jsx(Input, {\n                className: \"\",\n                placeholder: \"Nombre\",\n                type: \"text\",\n                onBlur: e => this.setDatosContacto('nombre', e)\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"form-group\",\n              children: /*#__PURE__*/_jsx(Input, {\n                type: \"email\",\n                onBlur: e => this.setDatosContacto('email', e),\n                className: \"form-control\",\n                id: \"exampleInputEmail1\",\n                \"aria-describedby\": \"emailHelp\",\n                placeholder: \"Enter email\"\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"text-danger\",\n              children: this.state.mensajeError\n            })]\n          }), /*#__PURE__*/_jsx(Button, {\n            onClick: e => this.FinalizarCompra(this.props, e),\n            className: \"mr-0 btn-grad w-100\",\n            color: \"primary\",\n            children: \"Finalizar compra\"\n          })]\n        })\n      }, i));\n      let img_cat = estado.categoria.toLowerCase();\n      dataTable.push( /*#__PURE__*/_jsxs(\"tbody\", {\n        children: [/*#__PURE__*/_jsxs(\"tr\", {\n          children: [/*#__PURE__*/_jsxs(\"td\", {\n            className: \"td-name fc-val\",\n            children: [/*#__PURE__*/_jsxs(\"a\", {\n              className: \"fc-val\",\n              children: [\"Categoria \", data.product]\n            }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"small\", {\n              className: \"mr-auto img-container\",\n              children: [this.state.duracion, \"ia/s\", /*#__PURE__*/_jsx(\"img\", {\n                className: \"w-50\",\n                alt: \"...\",\n                src: `/assets/img/planes/cat_${img_cat}.png`\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"td\", {\n            className: \"td-number\",\n            children: [/*#__PURE__*/_jsx(\"small\", {\n              children: data.currency\n            }), estado.precio]\n          }), /*#__PURE__*/_jsx(\"td\", {\n            className: \"td-number\",\n            children: \"1\"\n          }), /*#__PURE__*/_jsxs(\"td\", {\n            className: \"td-number\",\n            children: [/*#__PURE__*/_jsx(\"small\", {\n              children: data.currency\n            }), estado.precio]\n          })]\n        }), /*#__PURE__*/_jsxs(\"tr\", {\n          children: [/*#__PURE__*/_jsx(\"td\", {\n            colSpan: \"2\"\n          }), /*#__PURE__*/_jsx(\"td\", {\n            className: \"td-total\",\n            children: \"Total\"\n          }), /*#__PURE__*/_jsxs(\"td\", {\n            className: \"td-price\",\n            children: [/*#__PURE__*/_jsxs(\"small\", {\n              children: [data.currency, \"/ \"]\n            }), estado.precio]\n          })]\n        })]\n      }, i));\n    });\n    return /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"checkout-page\",\n        id: \"checkout\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"section\",\n          children: /*#__PURE__*/_jsx(Container, {\n            children: /*#__PURE__*/_jsxs(Row, {\n              children: [/*#__PURE__*/_jsx(Col, {\n                lg: \"8\",\n                children: /*#__PURE__*/_jsxs(Form, {\n                  className: \"js-validate\",\n                  children: [/*#__PURE__*/_jsx(\"h3\", {\n                    className: \"title mb-0\",\n                    children: \"Resumen de pedido\"\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: \"cd-section\",\n                    id: \"contentAreas\",\n                    children: /*#__PURE__*/_jsx(\"div\", {\n                      id: \"tables\",\n                      children: /*#__PURE__*/_jsx(Row, {\n                        children: /*#__PURE__*/_jsx(Col, {\n                          md: \"12\",\n                          children: /*#__PURE__*/_jsx(Card, {\n                            className: \"card-plain\",\n                            children: /*#__PURE__*/_jsx(CardBody, {\n                              children: /*#__PURE__*/_jsxs(Table, {\n                                className: \"tablesorter table-shopping\",\n                                responsive: true,\n                                children: [/*#__PURE__*/_jsx(\"thead\", {\n                                  children: /*#__PURE__*/_jsxs(\"tr\", {\n                                    children: [/*#__PURE__*/_jsx(\"th\", {\n                                      children: \"Producto\"\n                                    }), /*#__PURE__*/_jsx(\"th\", {\n                                      className: \"text-right\",\n                                      children: \"Precio\"\n                                    }), /*#__PURE__*/_jsx(\"th\", {\n                                      className: \"text-right\",\n                                      children: \"Qty\"\n                                    }), /*#__PURE__*/_jsx(\"th\", {\n                                      className: \"text-right\",\n                                      children: \"Monto\"\n                                    })]\n                                  })\n                                }), dataTable]\n                              })\n                            })\n                          })\n                        })\n                      })\n                    })\n                  })]\n                })\n              }), /*#__PURE__*/_jsxs(Col, {\n                lg: \"4\",\n                children: [/*#__PURE__*/_jsx(\"h2\", {\n                  className: \"title\",\n                  children: \"Pagar\"\n                }), cpagoFinalizarCompra]\n              })]\n            })\n          })\n        }, 1)\n      })\n    });\n  }\n\n}\n\nexport default withRouter(Checkout);","map":null,"metadata":{},"sourceType":"module"}