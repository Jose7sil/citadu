{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _classCallCheck from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/rational/u00/repositorios/REACT-REPO/MSSR-NEXT-JS/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*!\n=========================================================\n* Proyecto: mssr-pays-integration\n* Componente : CheckoutBuy\n* Autor : José silva (RationalIT)\n* Versión : 1.0.0\n=========================================================\n*/\nimport React, { Component } from \"react\"; // nodejs library that concatenates classes\n\nimport classnames from \"classnames\";\nimport * as $ from 'jquery'; //Componente Boton de pago paypal\n\nimport TransbankCheck from \"../../../src/components/checkoutBuy/Transbank/TransbankCheck\";\nimport * as functions from '../../../src/components/shared/functions';\nimport environment from '../../../src/environments/environments'; // reactstrap components\n\nimport { Card, CardBody, Form, Button, Input, InputGroupAddon, InputGroup, Media, Container, Row, Table, Col } from \"reactstrap\";\nimport { withRouter, NextRouter } from 'next/router';\n/*!=======================================================\n  * Nombre: Shopping\n  * Descripción: Carga la informacion del carrito de compras\n  =========================================================*/\n\nvar Checkout = /*#__PURE__*/function (_Component) {\n  _inherits(Checkout, _Component);\n\n  var _super = _createSuper(Checkout);\n\n  function Checkout(props) {\n    var _this;\n\n    _classCallCheck(this, Checkout);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"API_URI\", environment.apiUrlAws);\n\n    _defineProperty(_assertThisInitialized(_this), \"setDatosContacto\", function (d, e) {\n      switch (d) {\n        case \"nombre\":\n          _this.setState({\n            nombre: e.target.value\n          });\n\n          break;\n\n        case \"email\":\n          _this.setState({\n            email: e.target.value\n          });\n\n          break;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"FinalizarCompra\", function (props, e) {\n      var emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\n\n      if (_this.state.nombre == \"\" || _this.state.email == \"\") {\n        $(\".alert-danger.cn\").css(\"display\", \"block\");\n\n        _this.setState({\n          mensajeError: \"Debe proporcionar un nombre y un email de contacto.\"\n        });\n\n        return false;\n      }\n\n      if (emailRegex.test(_this.state.email) == false) {\n        $(\".alert-danger.cn\").css(\"display\", \"block\");\n\n        _this.setState({\n          mensajeError: \"Email inválido.\"\n        });\n\n        return false;\n      }\n\n      var contact = {};\n      contact['nombre'] = _this.state.nombre;\n      contact['email'] = _this.state.email;\n      localStorage.setItem('contact', JSON.stringify(contact));\n\n      _this.setState({\n        mensajeError: \"\"\n      });\n\n      var cat = _this.state.categoria;\n      var duracion = _this.state.duracion;\n      var method = _this.state.method;\n      var prop = _this.props;\n\n      if (_this.state.method == \"transbank\") {\n        //Array data Create orden\n        var arr = {};\n\n        _this.state.products.forEach(function (data) {\n          arr['email'] = _this.state.email;\n          arr['nombre'] = _this.state.nombre;\n          arr['descuento'] = _this.state.descuento;\n          arr['total'] = _this.state.total;\n          arr['cupon'] = _this.state.cupon;\n          arr['productos'] = [{\n            \"duracion\": _this.state.duracion,\n            \"currency\": data.currency,\n            \"categoria\": functions.capitalizarPrimeraLetra(cat),\n            \"cantidad\": 1\n          }];\n        }); //Crear orden de pago transbank\n\n\n        return fetch(\"\".concat(_this.API_URI, \"/checkout/order/tbk\"), {\n          method: 'POST',\n          body: JSON.stringify(arr),\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          }\n        }).then(function (res) {\n          //console.log('res:', res);\n          return res.json();\n        }).then(function (data) {\n          if (data.statusCode == \"200\") {\n            console.log('###200###');\n            global.orden = data.body;\n            global.method = method;\n            prop.router.push({\n              pathname: \"/payment/order/\".concat(cat, \"/\").concat(duracion, \"/\")\n            });\n          }\n        }).catch(function (err) {\n          return console.log('#Error#', err);\n        });\n      }\n\n      if (_this.state.method == \"paypal\") {\n        global.method = method;\n        prop.router.push({\n          pathname: \"/payment/order/\".concat(cat, \"/\").concat(duracion, \"/\")\n        });\n      }\n    });\n\n    _this.state = {\n      products: [],\n      detail: [],\n      dataphone: [],\n      exchanges: \"\",\n      categoria: \"\",\n      duracion: \"\",\n      paymentTabs: 1,\n      discountFocus: undefined,\n      precio: 0,\n      subTotal: 0,\n      descuento: \"0\",\n      total: 0,\n      method: \"\",\n      email: \"\",\n      nombre: \"\",\n      cupon: \"\",\n      mensajeError: \"\"\n    };\n    _this.getProductsLS = _this.getProductsLS.bind(_assertThisInitialized(_this), props);\n    return _this;\n  }\n\n  _createClass(Checkout, [{\n    key: \"getProductsLS\",\n\n    /*!=======================================================\n    * Nombre:  getProductsLS\n    * Descripción: \n    =========================================================*/\n    value: function getProductsLS(props) {\n      this.setState({\n        categoria: props.categoria,\n        duracion: props.duracion\n      });\n      var products = localStorage.getItem('table');\n      var detail = JSON.parse(localStorage.getItem('detail'));\n      this.setState({\n        products: JSON.parse(products),\n        detail: detail,\n        subTotal: detail.amt,\n        total: detail.amt,\n        precio: detail.amt,\n        method: detail.method\n      }); //console.log('STATE getProductsLS:', this.state);\n    }\n    /*!=======================================================\n     * Nombre: componentDidMount\n     * Descripción: \n     =========================================================*/\n\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getProductsLS();\n    }\n    /*!=======================================================\n     * Nombre: setDatosContacto\n     * Descripción: \n     =========================================================*/\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var dataTable = [];\n      var cpagoFinalizarCompra = [];\n      var estado = this.state;\n      var detail = {};\n      this.state.products.map(function (data, i) {\n        for (var dia in data.price) {\n          if (dia !== _this2.state.categoria) continue;\n          detail = data.price[dia];\n        }\n\n        var applyDiscount = function applyDiscount(e) {//console.log('applyDiscount e', e);\n        };\n\n        cpagoFinalizarCompra.push( /*#__PURE__*/_jsx(Card, {\n          children: /*#__PURE__*/_jsxs(CardBody, {\n            children: [/*#__PURE__*/_jsxs(Form, {\n              className: \"code-validate\",\n              children: [/*#__PURE__*/_jsx(\"label\", {\n                children: \"Descuento\"\n              }), /*#__PURE__*/_jsxs(InputGroup, {\n                className: classnames({\n                  \"input-group-focus\": _this2.state.discountFocus\n                }),\n                children: [/*#__PURE__*/_jsx(Input, {\n                  className: \"fc-val\",\n                  \"aria-label\": \"Discount\",\n                  name: \"name\",\n                  placeholder: \"codigo descuento\",\n                  type: \"text\" // onFocus={(e) => setDiscountFocus(true)}\n                  //onBlur={(e) =>  setDiscountFocus(false)}\n\n                }), /*#__PURE__*/_jsx(InputGroupAddon, {\n                  addonType: \"append\",\n                  children: /*#__PURE__*/_jsx(Button, {\n                    onClick: function onClick(e) {\n                      return applyDiscount(e);\n                    },\n                    className: \"btn-grad\",\n                    color: \"primary\",\n                    type: \"button\",\n                    children: \"Aplicar\"\n                  })\n                })]\n              })]\n            }), /*#__PURE__*/_jsx(\"hr\", {\n              className: \"line-info mb-3\"\n            }), /*#__PURE__*/_jsxs(Media, {\n              className: \"align-items-center\",\n              children: [/*#__PURE__*/_jsx(\"h3\", {\n                className: \"h6 text-secondary mr-3\",\n                children: \"Subtotal\"\n              }), /*#__PURE__*/_jsx(Media, {\n                body: true,\n                className: \"text-right\",\n                children: /*#__PURE__*/_jsxs(\"span\", {\n                  className: \"color-mssr\",\n                  children: [data.currency, \" \", estado.subTotal]\n                })\n              })]\n            }), /*#__PURE__*/_jsxs(Media, {\n              className: \"align-items-center\",\n              children: [/*#__PURE__*/_jsx(\"h3\", {\n                className: \"h6 text-secondary mr-3\",\n                children: \"Descuento\"\n              }), /*#__PURE__*/_jsx(Media, {\n                body: true,\n                className: \"text-right\",\n                children: /*#__PURE__*/_jsxs(\"span\", {\n                  className: \"color-mssr\",\n                  children: [estado.descuento, \" %\"]\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"hr\", {\n              className: \"line-info mb-3\"\n            }), /*#__PURE__*/_jsxs(Media, {\n              className: \"align-items-center\",\n              children: [/*#__PURE__*/_jsx(\"h3\", {\n                className: \"h6\",\n                children: \"Total\"\n              }), /*#__PURE__*/_jsx(Media, {\n                body: true,\n                className: \"text-right\",\n                children: /*#__PURE__*/_jsxs(\"span\", {\n                  className: \"font-weight-semi-bold color-mssr\",\n                  children: [data.currency, \" \", estado.total]\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"hr\", {\n              className: \"line-info mb-3\"\n            }), /*#__PURE__*/_jsx(\"h4\", {\n              className: \"mb-1\",\n              children: \"Datos de contacto:\"\n            }), /*#__PURE__*/_jsxs(Form, {\n              className: \"form \",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"form-group\",\n                children: /*#__PURE__*/_jsx(Input, {\n                  className: \"\",\n                  placeholder: \"Nombre\",\n                  type: \"text\",\n                  onBlur: function onBlur(e) {\n                    return _this2.setDatosContacto('nombre', e);\n                  }\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"form-group\",\n                children: /*#__PURE__*/_jsx(Input, {\n                  type: \"email\",\n                  onBlur: function onBlur(e) {\n                    return _this2.setDatosContacto('email', e);\n                  },\n                  className: \"form-control\",\n                  id: \"exampleInputEmail1\",\n                  \"aria-describedby\": \"emailHelp\",\n                  placeholder: \"Enter email\"\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"text-danger\",\n                children: _this2.state.mensajeError\n              })]\n            }), /*#__PURE__*/_jsx(Button, {\n              onClick: function onClick(e) {\n                return _this2.FinalizarCompra(_this2.props, e);\n              },\n              className: \"mr-0 btn-grad w-100\",\n              color: \"primary\",\n              children: \"Finalizar compra\"\n            })]\n          })\n        }, i));\n        var img_cat = estado.categoria.toLowerCase();\n        dataTable.push( /*#__PURE__*/_jsxs(\"tbody\", {\n          children: [/*#__PURE__*/_jsxs(\"tr\", {\n            children: [/*#__PURE__*/_jsxs(\"td\", {\n              className: \"td-name fc-val\",\n              children: [/*#__PURE__*/_jsxs(\"a\", {\n                className: \"fc-val\",\n                children: [\"Categoria \", data.product]\n              }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"small\", {\n                className: \"mr-auto img-container\",\n                children: [_this2.state.duracion, \"ia/s\", /*#__PURE__*/_jsx(\"img\", {\n                  className: \"w-50\",\n                  alt: \"...\",\n                  src: \"/assets/img/planes/cat_\".concat(img_cat, \".png\")\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(\"td\", {\n              className: \"td-number\",\n              children: [/*#__PURE__*/_jsx(\"small\", {\n                children: data.currency\n              }), estado.precio]\n            }), /*#__PURE__*/_jsx(\"td\", {\n              className: \"td-number\",\n              children: \"1\"\n            }), /*#__PURE__*/_jsxs(\"td\", {\n              className: \"td-number\",\n              children: [/*#__PURE__*/_jsx(\"small\", {\n                children: data.currency\n              }), estado.precio]\n            })]\n          }), /*#__PURE__*/_jsxs(\"tr\", {\n            children: [/*#__PURE__*/_jsx(\"td\", {\n              colSpan: \"2\"\n            }), /*#__PURE__*/_jsx(\"td\", {\n              className: \"td-total\",\n              children: \"Total\"\n            }), /*#__PURE__*/_jsxs(\"td\", {\n              className: \"td-price\",\n              children: [/*#__PURE__*/_jsxs(\"small\", {\n                children: [data.currency, \"/ \"]\n              }), estado.precio]\n            })]\n          })]\n        }, i));\n      });\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"checkout-page\",\n          id: \"checkout\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"section\",\n            children: /*#__PURE__*/_jsx(Container, {\n              children: /*#__PURE__*/_jsxs(Row, {\n                children: [/*#__PURE__*/_jsx(Col, {\n                  lg: \"8\",\n                  children: /*#__PURE__*/_jsxs(Form, {\n                    className: \"js-validate\",\n                    children: [/*#__PURE__*/_jsx(\"h3\", {\n                      className: \"title mb-0\",\n                      children: \"Resumen de pedido\"\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: \"cd-section\",\n                      id: \"contentAreas\",\n                      children: /*#__PURE__*/_jsx(\"div\", {\n                        id: \"tables\",\n                        children: /*#__PURE__*/_jsx(Row, {\n                          children: /*#__PURE__*/_jsx(Col, {\n                            md: \"12\",\n                            children: /*#__PURE__*/_jsx(Card, {\n                              className: \"card-plain\",\n                              children: /*#__PURE__*/_jsx(CardBody, {\n                                children: /*#__PURE__*/_jsxs(Table, {\n                                  className: \"tablesorter table-shopping\",\n                                  responsive: true,\n                                  children: [/*#__PURE__*/_jsx(\"thead\", {\n                                    children: /*#__PURE__*/_jsxs(\"tr\", {\n                                      children: [/*#__PURE__*/_jsx(\"th\", {\n                                        children: \"Producto\"\n                                      }), /*#__PURE__*/_jsx(\"th\", {\n                                        className: \"text-right\",\n                                        children: \"Precio\"\n                                      }), /*#__PURE__*/_jsx(\"th\", {\n                                        className: \"text-right\",\n                                        children: \"Qty\"\n                                      }), /*#__PURE__*/_jsx(\"th\", {\n                                        className: \"text-right\",\n                                        children: \"Monto\"\n                                      })]\n                                    })\n                                  }), dataTable]\n                                })\n                              })\n                            })\n                          })\n                        })\n                      })\n                    })]\n                  })\n                }), /*#__PURE__*/_jsxs(Col, {\n                  lg: \"4\",\n                  children: [/*#__PURE__*/_jsx(\"h2\", {\n                    className: \"title\",\n                    children: \"Pagar\"\n                  }), cpagoFinalizarCompra]\n                })]\n              })\n            })\n          }, 1)\n        })\n      });\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(_ref) {\n      var _ref$query = _ref.query,\n          categoria = _ref$query.categoria,\n          duracion = _ref$query.duracion;\n      return {\n        categoria: categoria,\n        duracion: duracion\n      };\n    }\n  }]);\n\n  return Checkout;\n}(Component);\n\nexport default withRouter(Checkout);","map":null,"metadata":{},"sourceType":"module"}